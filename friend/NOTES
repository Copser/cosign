Friend is the guest-account facility for cosign.  It allows anyone with a
valid e-mail address to self-create a guest account, login, change the
account's password, and perform an e-mail validated password reset.

Friend does not provide high security, authorization information,
or anything at all but a simple way to let unaffiliated individuals
into your protected web sites.  It is assumed that users or services
requiring high security or strong authorization will use your standard
authentication mechanism ( e.g. Kerberos, DCE, x.509, etc. )

o to do ( v 0.9.0 ):

    o remove all of the umich specific logic and data so friend can be
      used elsewhere.
    o refactor, review, and simplify code.
    o move data and settings to a configuration file.

    Until these refinements are made, there is some almost silly
    duplication of code ( really, we're trying to keep things as plain
    and simple as possibly while writing/debugging -- we'll add cleverness
    when we're sure everything works ).

    Search for FRIEND_DB ( the hostname of your friend database ),
    FRIEND_LOGIN ( login name to use on that host ), and FRIEND_PASSWD
    ( db password ) in the php directory and replace them with appropriate
    values for your site.

    You almost certainly want to rewrite all of the files in the
    smarty/templates directory too.

o requirements

    Friend currently requires that php be installed on your weblogin
    server and that you have access to a mysql server.  Additionally,
    Friend requires the following php modules:

	Smarty		http://smarty.php.net/
	Mail
	Mail/mime
	Mail/RFC822

    You will also need sendmail ( or compatible MTA ) so Friend can send
    its messages.

o example configuration, apache.

    Friend adds an interesting wrinkle to your weblogin server in that
    it becomes necessary for portions of /friend/ to be CosignProtected.
    We do this at UMich with the following config options in the srm
    file for weblogin.umich.edu:

    Alias           /friend/        /usr/cosign/friend/php/

    <IfModule mod_cosign.c>
        CosignProtected On
        CosignHostname  weblogin.umich.edu
        CosignRedirect  https://weblogin.umich.edu/

        CosignService   weblogin
        CosignCrypto    /etc/weblogin.pem /etc/weblogin.pem /var/cosign/certs/CA

        <Directory /usr/cosign>
	    # the login screen must not be cosignprotected :)
            CosignProtected off
        </Directory>

        <Location /friend/passwd/>
            CosignProtected on
        </Location>
    </IfModule>

o database

    We recommend that your mysql server be well tuned and that particular
    attention be paid to its security.  Future releases will include
    support for PostgreSQL and Oracle RDBMS systems as backends.

o table definitions:

    CREATE TABLE acquaintances (
	acquaintance_id     bigint( 20 )    not null auto_increment,
	account_name        VARCHAR( 255 )  NOT NULL,
	token               VARCHAR( 255 )  NOT NULL,
	ref                 BLOB,
	timestamp           datetime,
	primary key( acquaintance_id )
    );

    CREATE TABLE friends (
	friend_id           bigint( 20 )    not null auto_increment,
	account_name        VARCHAR( 255 )  NOT NULL unique,
	passwd               VARCHAR( 255 )  NOT NULL,
	timestamp           datetime,
	primary key( friend_id )
    );

    CREATE TABLE resets (       
	reset_id            bigint( 20 )    not null auto_increment,
	account_name        VARCHAR( 255 )  NOT NULL,       
	token               VARCHAR( 255 )  NOT NULL,
	timestamp           datetime, 
	primary key( reset_id )       
    );

o support & questions

    As with all other parts of cosign, please contact cosign@umich.edu
    with any questions.

