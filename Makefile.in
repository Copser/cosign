CC=	@CC@
ALL=	common libsnet filters/common @FILTERS@ libcgi cgi html daemon 
TARGETS= cgi html daemon @FILTERS@
FILTERS= @FILTERS@ 
CFLAGS=

filters:	@FILTERS@
all:		filters
everything:	${ALL}

cgi daemon:	version.o common libsnet
filters/apache filters/apache2:	version.o common filters/common libsnet
cgi:	libcgi

${ALL}:	version.o FRC
	cd $@; ${MAKE} ${MFLAGS} all

FRC:

clean:
	rm -f version.o
	for i in ${ALL}; \
	    do (cd $$i; ${MAKE} ${MFLAGS} clean); \
	done

VERSION=`date +%Y%m%d`
DISTDIR=../cosign-${VERSION}

dist   : distclean
	mkdir ${DISTDIR}
	tar -c -f - -X EXCLUDE . | tar xpf - -C ${DISTDIR}
	echo ${VERSION} > ${DISTDIR}/VERSION

distclean: clean
	( cd libsnet ; make distclean )
	rm -f config.log config.status config.cache Makefile \
	  libcgi/Makefile cgi/Makefile html/Makefile daemon/Makefile \
	  filters/apache/Makefile filters/apache2/Makefile \
	  filters/common/Makefile common/Makefile
	rm -rf autom4te.cache

install: @FILTERS@
	for i in ${FILTERS}; \
	    do (cd $$i; ${MAKE} ${MFLAGS} install); \
	done

install-all : everything
	for i in ${TARGETS}; \
	    do (cd $$i; ${MAKE} ${MFLAGS} install); \
	done

version.o : version.c
	${CC} ${CFLAGS} -DVERSION=\"`cat VERSION`\" -c version.c
