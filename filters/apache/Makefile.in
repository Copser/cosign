##
##  Makefile -- Build procedure for sample cosign Apache module
##  Autogenerated via ``apxs -n cosign -g''.
##

#   the used tools
CC=            	@CC@
APXS=          	@APXS@
APACHECTL=     	@APACHECTL@
INSTALL=       	@INSTALL@
FILTERDB=	@filterdb@
PROXYDB=	@proxydb@
COSIGNTICKETCACHE=	@ticketcache@


#   additional user defines, includes and libraries

INCPATH=        @CPPFLAGS@ @APXS_INCLUDE@ -I../../libsnet @GSSINC@ -I../../common/ -I../common/
OPTOPTS=        @OPTOPTS@
DEFS=           @TLSDEFS@ @KRBDEFS@ @GSSDEFS@ -D_PROXY_DB=\"${PROXYDB}\" -D_FILTER_DB=\"${FILTERDB}\" -D_COSIGN_TICKET_CACHE=\"${COSIGNTICKETCACHE}\"
LIBS=           @GSSLIBS@ @ADDLIBS@
LDFLAGS=        @GSSLDFLAGS@ @ADDLDFLAGS@ @LDFLAGS@ ${LIBS}

CFLAGS=         ${DEFS} ${OPTOPTS} @CFLAGS@ @APXS_CFLAGS@ @APXS_CFLAGS_SHLIB@ ${INCPATH}

OBJ=	mod_cosign.o \
	connect.o cookiefs.o sparse.o \
	argcargv.o fbase64.o \
	mkcookie.o rate.o version.o snet.o

#   the default target
all: mod_cosign.so

# all the stuff that's not right here
connect.o : ../common/connect.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
cookiefs.o : ../common/cookiefs.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
sparse.o : ../common/sparse.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
argcargv.o : ../../common/argcargv.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
fbase64.o : ../../common/fbase64.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
mkcookie.o : ../../common/mkcookie.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
rate.o : ../../common/rate.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<
version.o : ../../version.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -DVERSION=\"`cat ../../VERSION`\" \
		-o $@ $<
snet.o : ../../libsnet/snet.c
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<

#   compile the DSO file
mod_cosign.so: ${OBJ}
	$(APXS) -c ${OBJ} ${LDFLAGS}

#   install the DSO file into the Apache installation
#   and activate it in the Apache configuration
install: all
	$(APXS) -i -a -n 'cosign' mod_cosign.so

#   cleanup
clean:
	rm -f *.o mod_cosign.so

#   reload the module by installing and restarting Apache
reload: install restart

#   the general Apache start/restart/stop procedures
start:
	$(APACHECTL) start
startssl:
	$(APACHECTL) startssl
restart:
	$(APACHECTL) restart
stop:
	$(APACHECTL) stop

